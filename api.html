
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>API &#8212; DeepQMC 0.3.0.post8.dev0+8e6f186 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/katex-math.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"></script>
    <script src="_static/katex_autorenderer.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="References" href="refs.html" />
    <link rel="prev" title="Command-line interface" href="cli.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">DeepQMC</a></h1>



<p class="blurb">Deep-learning quantum Monte Carlo for electrons in real space</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=deepqmc&repo=deepqmc&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/deepqmc/deepqmc">
    <img
        alt="https://secure.travis-ci.org/deepqmc/deepqmc.svg?branch=master"
        src="https://secure.travis-ci.org/deepqmc/deepqmc.svg?branch=master"
    />
</a>
</p>




    

<p>
<a class="badge" href="https://codecov.io/github/deepqmc/deepqmc">
    <img
    alt="https://codecov.io/github/deepqmc/deepqmc/coverage.svg?branch=master"
    src="https://codecov.io/github/deepqmc/deepqmc/coverage.svg?branch=master"
    />
</a>
</p>
<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line interface</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-deepqmc">Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-deepqmc.wf">Wave functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#paulinet">PauliNet</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="refs.html">References</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cli.html" title="previous chapter">Command-line interface</a></li>
      <li>Next: <a href="refs.html" title="next chapter">References</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="api">
<span id="id1"></span><h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<p>The API is designed in such a way that entering it via the top-level <a class="reference internal" href="#deepqmc.train" title="deepqmc.train"><code class="xref py py-func docutils literal notranslate"><span class="pre">deepqmc.train()</span></code></a> and <a class="reference internal" href="#deepqmc.wf.PauliNet.from_hf" title="deepqmc.wf.PauliNet.from_hf"><code class="xref py py-func docutils literal notranslate"><span class="pre">deepqmc.wf.PauliNet.from_hf()</span></code></a> entry points enables complete specification of all parameters via nested dictionaries that can be encoded in a <a class="reference external" href="https://github.com/toml-lang/toml">TOML</a> file, which is used by the <a class="reference internal" href="cli.html#cli"><span class="std std-ref">Command-line interface</span></a>. The lower-level dictionaries (stored under <code class="docutils literal notranslate"><span class="pre">*_kwargs</span></code> keys) are gradually unwrapped and passed into lower-level API components.</p>
<p>All classes documented below with a Shape section are derived from <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a> and are to be used as such.</p>
<div class="section" id="module-deepqmc">
<span id="training"></span><h2>Training<a class="headerlink" href="#module-deepqmc" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="deepqmc.train">
<code class="sig-prename descclassname">deepqmc.</code><code class="sig-name descname">train</code><span class="sig-paren">(</span><em class="sig-param">wf, workdir=None, save_every=None, state=None, min_rewind=10, blowup_threshold=0.5, raise_blowup=True, return_every=None, chkpts=None, *, n_steps=10000, batch_size=10000, epoch_size=100, optimizer='AdamW', learning_rate=0.01, optimizer_kwargs={'Adam': {'betas': [0.9, 0.9]}, 'AdamW': {'betas': [0.9, 0.9], 'weight_decay': 0.01}}, lr_scheduler='CyclicLR', lr_scheduler_kwargs={'CyclicLR': {'base_lr': 0.0001, 'cycle_momentum': False, 'max_lr': 0.01, 'mode': 'triangular2', 'step_size_up': 250}, 'OneCycleLR': {'anneal_strategy': 'linear', 'max_lr': 0.005, 'pct_start': 0.075, 'total_steps': 5000}, 'inverse': {'decay_rate': 200}, 'scan': {'eq_steps': 100, 'rate': 1.05, 'start': 0.1}}, equilibrate=True, fit_kwargs=None, sampler_kwargs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/train.html#train"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Train a wave function model.</p>
<p>This is the main top-level entry point of the DeepQMC package. This function
initializes a <a class="reference internal" href="#deepqmc.sampling.LangevinSampler" title="deepqmc.sampling.LangevinSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">LangevinSampler</span></code></a>, an optimizer, a
learning rate scheduler, optionally restores a previously stored training
state, sets up a Tensorboard writer, and calls <a class="reference internal" href="#deepqmc.fit.fit_wf" title="deepqmc.fit.fit_wf"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit_wf()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf</strong> (<a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>) – wave function model to be trained</p></li>
<li><p><strong>workdir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – path where to store Tensorboard event file, intermediate
parameter states, and HDF5 file with the fit trajectory</p></li>
<li><p><strong>save_every</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of steps between storing current parameter state</p></li>
<li><p><strong>state</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – restore optimizer and scheduler states from a stored state</p></li>
<li><p><strong>n_steps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of optimization steps</p></li>
<li><p><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of samples used in a single step</p></li>
<li><p><strong>epoch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of steps between sampling from the wave function</p></li>
<li><p><strong>optimizer</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – name of the optimizer from <a class="reference external" href="https://pytorch.org/docs/stable/optim.html#module-torch.optim" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.optim</span></code></a></p></li>
<li><p><strong>learning_rate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – learning rate for gradient-descent optimizers</p></li>
<li><p><strong>optimizer_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to the optimizers, organized
by optimizer name</p></li>
<li><p><strong>lr_scheduler</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – <p>name of the learning rate scheduling scheme</p>
<ul>
<li><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code></a> – no learning rate scheduling</p></li>
<li><p>uppercase name – name from <code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.optim.lr_scheduler</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'inverse'</span></code> – <span class="math">\(\mathrm{lr}(n):=1/(1+n/r)\)</span>, where <em>r</em>
is decay rate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'scan'</span></code> – <span class="math">\(\mathrm{lr})(n):=sr^{n-n_0}\)</span></p></li>
</ul>
</p></li>
<li><p><strong>lr_scheduler_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to the scheduler,
organized by scheduler name</p></li>
<li><p><strong>equilibrate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether to equilibrate sampler before training</p></li>
<li><p><strong>fit_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – arguments passed to <a class="reference internal" href="#deepqmc.fit.fit_wf" title="deepqmc.fit.fit_wf"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit_wf()</span></code></a></p></li>
<li><p><strong>sampler_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – arguments passed to
<a class="reference internal" href="#deepqmc.sampling.LangevinSampler" title="deepqmc.sampling.LangevinSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">LangevinSampler</span></code></a></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="deepqmc.evaluate">
<code class="sig-prename descclassname">deepqmc.</code><code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">wf</em>, <em class="sig-param">store_steps=False</em>, <em class="sig-param">workdir=None</em>, <em class="sig-param">log_dict=None</em>, <em class="sig-param">*</em>, <em class="sig-param">n_steps=500</em>, <em class="sig-param">sample_size=1000</em>, <em class="sig-param">sample_kwargs=None</em>, <em class="sig-param">sampler_kwargs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/evaluate.html#evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate a wave function model.</p>
<p>This is a top-level API function that rigorously evaluates a trained wave
function model. It initializes a <a class="reference internal" href="#deepqmc.sampling.LangevinSampler" title="deepqmc.sampling.LangevinSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">LangevinSampler</span></code></a>,
sets up a Tensorboard writer, and calls <a class="reference internal" href="#deepqmc.sampling.sample_wf" title="deepqmc.sampling.sample_wf"><code class="xref py py-func docutils literal notranslate"><span class="pre">sample_wf()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf</strong> (<a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>) – wave function model to be evaluated</p></li>
<li><p><strong>store_steps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether to store individual sampled electron configuraitons</p></li>
<li><p><strong>workdir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – path where to store Tensorboard event file and HDF5 file with
sampling block energies</p></li>
<li><p><strong>n_steps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of sampling steps</p></li>
<li><p><strong>sample_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of Markov-chain walkers</p></li>
<li><p><strong>n_decorrelate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of extra steps between samples included
in the expectation value averaging</p></li>
<li><p><strong>sampler_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to
<a class="reference internal" href="#deepqmc.sampling.LangevinSampler" title="deepqmc.sampling.LangevinSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">LangevinSampler</span></code></a></p></li>
<li><p><strong>sample_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to
<a class="reference internal" href="#deepqmc.sampling.sample_wf" title="deepqmc.sampling.sample_wf"><code class="xref py py-func docutils literal notranslate"><span class="pre">sample_wf()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Expectation values with standard errors.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.Molecule">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.</code><code class="sig-name descname">Molecule</code><span class="sig-paren">(</span><em class="sig-param">coords</em>, <em class="sig-param">charges</em>, <em class="sig-param">charge</em>, <em class="sig-param">spin</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/molecule.html#Molecule"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.Molecule" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a molecule.</p>
<p>The array-like arguments accept anything that can be transformed to
<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coords</strong> (<em>array-like</em><em>, </em><em>rank-2</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>a.u.</em>) – atom coordinates as rows</p></li>
<li><p><strong>charges</strong> (<em>array-like</em><em>, </em><em>rank-1</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – atom charges</p></li>
<li><p><strong>charge</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – total charge of a molecule</p></li>
<li><p><strong>spin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – total spin multiplicity</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="deepqmc.Molecule.from_name">
<em class="property">classmethod </em><code class="sig-name descname">from_name</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/molecule.html#Molecule.from_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.Molecule.from_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a molecule from a database of named molecules.</p>
<p>The available names are in <code class="xref py py-attr docutils literal notranslate"><span class="pre">Molecule.all_names</span></code>.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-deepqmc.fit"></span><dl class="function">
<dt id="deepqmc.fit.fit_wf">
<code class="sig-prename descclassname">deepqmc.fit.</code><code class="sig-name descname">fit_wf</code><span class="sig-paren">(</span><em class="sig-param">wf</em>, <em class="sig-param">loss_func</em>, <em class="sig-param">opt</em>, <em class="sig-param">sampler</em>, <em class="sig-param">steps</em>, <em class="sig-param">writer=None</em>, <em class="sig-param">log_dict=None</em>, <em class="sig-param">require_energy_gradient=False</em>, <em class="sig-param">require_psi_gradient=True</em>, <em class="sig-param">subbatch_size=None</em>, <em class="sig-param">max_memory=None</em>, <em class="sig-param">*</em>, <em class="sig-param">clip_outliers=True</em>, <em class="sig-param">q=5</em>, <em class="sig-param">max_grad_norm=None</em>, <em class="sig-param">kfac=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/fit.html#fit_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.fit.fit_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a wave function using the variational principle and gradient descent.</p>
<p>This is a low-level interface, see <a class="reference internal" href="#deepqmc.train" title="deepqmc.train"><code class="xref py py-func docutils literal notranslate"><span class="pre">train()</span></code></a> for a high-level
interface. This iterator iteratively draws samples from the sampler, evaluates
the local energy, processes outliers, calculates the loss function, and updates
the wave function model parameters using a gradient of the loss and an
optimizer. Diagnostics is written into the Tensorboard writer, and finally
at the end of each iteration the step index is yielded, so that the caller
can do some additional processing such as learning rate scheduling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf</strong> (<a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>) – wave function model to be fitted</p></li>
<li><p><strong>loss_func</strong> (<a class="reference internal" href="#deepqmc.fit.WaveFunctionLoss" title="deepqmc.fit.WaveFunctionLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunctionLoss</span></code></a>) – loss function that accepts local
energy and wave function values</p></li>
<li><p><strong>opt</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/optim.html#torch.optim.Optimizer" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.optim.Optimizer</span></code></a>) – optimizer</p></li>
<li><p><strong>sampler</strong> (<em>iterator</em>) – yields batches of electron coordinate samples</p></li>
<li><p><strong>steps</strong> (<em>iterator</em>) – yields step indexes</p></li>
<li><p><strong>writer</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensorboard.html#torch.utils.tensorboard.writer.SummaryWriter" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.tensorboard.writer.SummaryWriter</span></code></a>) – Tensorboard writer</p></li>
<li><p><strong>log_dict</strong> (<em>dict-like</em>) – batch data will be stored in this dictionary if given</p></li>
<li><p><strong>require_energy_gradient</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the loss function requires
gradients of the local energy</p></li>
<li><p><strong>require_psi_gradient</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the loss function requires
gradients of the wave function</p></li>
<li><p><strong>subbatch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of samples for a single vectorized loss evaluation.
If None and on a GPU, subbatch_size is estimated, else if None and on a CPU,
no subbatching is done.</p></li>
<li><p><strong>max_memory</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – maximum amount of allocated GPU memory (MiB) to be
considered if automatically estimating the subbatch_size. If <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code></a>
and subbatch_size is estimated, the maximum memory is set to the total
free GPU memory. When training on CPU always set to <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code></a>.</p></li>
<li><p><strong>clip_outliers</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether to clip local energy outliers</p></li>
<li><p><strong>q</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – multiple of MAE defining outliers</p></li>
<li><p><strong>max_grad_norm</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – maximum gradient norm passed to
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.utils.clip_grad_norm_.html#torch.nn.utils.clip_grad_norm_" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.nn.utils.clip_grad_norm_()</span></code></a></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.fit.WaveFunctionLoss">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.fit.</code><code class="sig-name descname">WaveFunctionLoss</code><span class="sig-paren">(</span><em class="sig-param">*args: Any</em>, <em class="sig-param">**kwargs: Any</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/fit.html#WaveFunctionLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.fit.WaveFunctionLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for all wave function loss functions.</p>
<p>Any such loss must be derived from the local energy and wave function
values, <span class="math">\(L(\{E_\text{loc}[\psi],\ln|\psi|,w\})\)</span>, using also
importance-sampling weights <em>w</em>.</p>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input1, <span class="math">\(E_\text{loc}[\psi](\mathbf r)\)</span>: <span class="math">\((*)\)</span></p></li>
<li><p>Input2, <span class="math">\(\ln|\psi(\mathbf r)|\)</span>: <span class="math">\((*)\)</span></p></li>
<li><p>Input3, <span class="math">\(w(\mathbf r)\)</span>: <span class="math">\((*)\)</span></p></li>
<li><p>Output, <em>L</em>: <span class="math">\(()\)</span></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.fit.LossEnergy">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.fit.</code><code class="sig-name descname">LossEnergy</code><span class="sig-paren">(</span><em class="sig-param">*args: Any</em>, <em class="sig-param">**kwargs: Any</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/fit.html#LossEnergy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.fit.LossEnergy" title="Permalink to this definition">¶</a></dt>
<dd><p>Total energy loss function.</p>
<div class="math">
\[L:=2\mathbb E\big[(E_\text{loc}-\mathbb E[E_\text{loc}])\ln|\psi|\big]

\]</div>
<p>Taking a derivative of only the logarithm, the resulting gradient is equivalent,
thanks to the Hermitian property of the Hamiltonian, to the gradient of the
plain total energy loss function, <span class="math">\(\mathbb E[E_\text{loc}]\)</span>.</p>
</dd></dl>

<span class="target" id="module-deepqmc.sampling"></span><dl class="function">
<dt id="deepqmc.sampling.sample_wf">
<code class="sig-prename descclassname">deepqmc.sampling.</code><code class="sig-name descname">sample_wf</code><span class="sig-paren">(</span><em class="sig-param">wf</em>, <em class="sig-param">sampler</em>, <em class="sig-param">steps</em>, <em class="sig-param">writer=None</em>, <em class="sig-param">write_figures=False</em>, <em class="sig-param">log_dict=None</em>, <em class="sig-param">blocks=None</em>, <em class="sig-param">*</em>, <em class="sig-param">block_size=10</em>, <em class="sig-param">equilibrate=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/sampling.html#sample_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.sampling.sample_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Sample a wave function and accumulate expectation values.</p>
<p>This is a low-level interface, see <a class="reference internal" href="#deepqmc.evaluate" title="deepqmc.evaluate"><code class="xref py py-func docutils literal notranslate"><span class="pre">evaluate()</span></code></a> for a high-level
interface. This iterator iteratively draws samples from the sampler, detects
when equilibrium is reached, and starts calculating and accumulating
local energies to get an estimate of the energy. Diagnostics is written into
the Tensorboard writer, and every full block, the step index, the current
estimate of the energy, and the sampled electron coordinates are yielded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf</strong> (<a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>) – wave function model to be sampled</p></li>
<li><p><strong>sampler</strong> (<em>iterator</em>) – yields batches of electron coordinate samples</p></li>
<li><p><strong>steps</strong> (<em>iterator</em>) – yields step indexes</p></li>
<li><p><strong>writer</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensorboard.html#torch.utils.tensorboard.writer.SummaryWriter" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.tensorboard.writer.SummaryWriter</span></code></a>) – Tensorboard writer</p></li>
<li><p><strong>log_dict</strong> (<em>dict-like</em>) – step data will be stored in this dictionary if given</p></li>
<li><p><strong>blocks</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – used as storage of blocks. If not given, the iterator
uses a local storage.</p></li>
<li><p><strong>block_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – size of a block (a sequence of samples)</p></li>
<li><p><strong>equilibrate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – if false, local energies are calculated and
accumulated from the first sampling step, if true equilibrium is
detected automatically, if integer argument, specifies number of
equilibration steps</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.sampling.MetropolisSampler">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.sampling.</code><code class="sig-name descname">MetropolisSampler</code><span class="sig-paren">(</span><em class="sig-param">wf</em>, <em class="sig-param">rs</em>, <em class="sig-param">writer=None</em>, <em class="sig-param">*</em>, <em class="sig-param">tau=0.1</em>, <em class="sig-param">n_first_certain=3</em>, <em class="sig-param">target_acceptance=0.57</em>, <em class="sig-param">n_discard=50</em>, <em class="sig-param">n_decorrelate=1</em>, <em class="sig-param">max_age=None</em>, <em class="sig-param">log_psi_threshold=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/sampling.html#MetropolisSampler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.sampling.MetropolisSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Samples electronic wave functions with vanilla Metropolis–Hastings Monte Carlo.</p>
<p>An instance of this class is an iterator that yields 2-tuples of electron
coordinates and wave function values with shapes of <span class="math">\((\cdot,N,3)\)</span> and
<span class="math">\((\cdot)\)</span>, respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf</strong> (<a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>) – wave function to sample from</p></li>
<li><p><strong>rs</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a><span class="math">\((\cdot,N,3)\)</span>) – initial positions of the
Markov-chain walkers</p></li>
<li><p><strong>tau</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – <span class="math">\(\tau\)</span>, proposal step size</p></li>
<li><p><strong>n_first_certain</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of initial steps done with 100% acceptance</p></li>
<li><p><strong>target_acceptance</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – initial step size is automatically adjusted
to achieve this requested acceptance</p></li>
<li><p><strong>n_discard</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of steps in the beginning of the sampling that are
discarded</p></li>
<li><p><strong>n_decorrelate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of extra steps between yielded samples</p></li>
<li><p><strong>max_age</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – maximum age of a walker without a move after which it is
moved with 100% acceptance</p></li>
<li><p><strong>log_psi_threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – steps into proposals with log wave function values
below this threshold are always rejected</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="deepqmc.sampling.MetropolisSampler.from_wf">
<em class="property">classmethod </em><code class="sig-name descname">from_wf</code><span class="sig-paren">(</span><em class="sig-param">wf</em>, <em class="sig-param">*</em>, <em class="sig-param">sample_size=2000</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/sampling.html#MetropolisSampler.from_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.sampling.MetropolisSampler.from_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a sampler with random initial walker positions.</p>
<p>The walker positions are sampled from Gaussians centered on atoms, with
charge distribution optionally supplied by the wave function ansatz,
otherwise taken from the nuclear charges.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf</strong> (<a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>) – wave function to be sampled from</p></li>
<li><p><strong>sample_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of Markov-chain walkers</p></li>
<li><p><strong>kwargs</strong> – all other arguments are passed to the constructor</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="deepqmc.sampling.MetropolisSampler.iter_batches">
<code class="sig-name descname">iter_batches</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">epoch_size</em>, <em class="sig-param">batch_size</em>, <em class="sig-param">range=&lt;class 'range'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/sampling.html#MetropolisSampler.iter_batches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.sampling.MetropolisSampler.iter_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over buffered batches sampled in epochs.</p>
<p>Each epoch, the wave function is sampled in one shot, the samples
are buffered, and used to form all batches within a given epoch, entirely
shuffled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epoch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of batches per epoch</p></li>
<li><p><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of samples in a batch</p></li>
<li><p><strong>range</strong> (<em>callable</em>) – alternative to <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#range" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a></p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="deepqmc.sampling.LangevinSampler">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.sampling.</code><code class="sig-name descname">LangevinSampler</code><span class="sig-paren">(</span><em class="sig-param">wf</em>, <em class="sig-param">rs</em>, <em class="sig-param">writer=None</em>, <em class="sig-param">*</em>, <em class="sig-param">tau=0.1</em>, <em class="sig-param">n_first_certain=3</em>, <em class="sig-param">target_acceptance=0.57</em>, <em class="sig-param">n_discard=50</em>, <em class="sig-param">n_decorrelate=1</em>, <em class="sig-param">max_age=None</em>, <em class="sig-param">log_psi_threshold=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/sampling.html#LangevinSampler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.sampling.LangevinSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Samples electronic wave functions with Langevin Monte Carlo.</p>
<p>Derived from <a class="reference internal" href="#deepqmc.sampling.MetropolisSampler" title="deepqmc.sampling.MetropolisSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetropolisSampler</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="module-deepqmc.wf">
<span id="wave-functions"></span><h2>Wave functions<a class="headerlink" href="#module-deepqmc.wf" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="deepqmc.wf.WaveFunction">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.</code><code class="sig-name descname">WaveFunction</code><span class="sig-paren">(</span><em class="sig-param">mol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/base.html#WaveFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.WaveFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for all trial wave functions.</p>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <span class="math">\(\mathbf r\)</span>, a.u.: <span class="math">\((\cdot,N,3)\)</span></p></li>
<li><p>Output1, <span class="math">\(\ln|\psi(\mathbf r)|\)</span>: <span class="math">\((\cdot)\)</span></p></li>
<li><p>Output2, <span class="math">\(\operatorname{sgn}\psi(\mathbf r)\)</span>: <span class="math">\((\cdot)\)</span></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="section" id="paulinet">
<h3>PauliNet<a class="headerlink" href="#paulinet" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="deepqmc.wf.PauliNet">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.</code><code class="sig-name descname">PauliNet</code><span class="sig-paren">(</span><em class="sig-param">mol</em>, <em class="sig-param">basis</em>, <em class="sig-param">n_configurations=1</em>, <em class="sig-param">n_orbitals=None</em>, <em class="sig-param">return_log=True</em>, <em class="sig-param">use_sloglindet='training'</em>, <em class="sig-param">*</em>, <em class="sig-param">cusp_correction=True</em>, <em class="sig-param">cusp_electrons=True</em>, <em class="sig-param">backflow_type='orbital'</em>, <em class="sig-param">backflow_channels=1</em>, <em class="sig-param">backflow_transform='mult'</em>, <em class="sig-param">rc_scaling=1.0</em>, <em class="sig-param">cusp_alpha=10.0</em>, <em class="sig-param">freeze_embed=False</em>, <em class="sig-param">omni_factory='omni_schnet'</em>, <em class="sig-param">omni_kwargs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/paulinet.html#PauliNet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.PauliNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements the PauliNet ansatz from <a class="reference internal" href="refs.html#hermannnc20" id="id2"><span>[HermannNC20]</span></a>.</p>
<p>Derived from <a class="reference internal" href="#deepqmc.wf.WaveFunction" title="deepqmc.wf.WaveFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveFunction</span></code></a>. This constructor provides a fully
flexible low-level interface. See the alternative constructors for the
high-level interfaces.</p>
<p>The PauliNet ansatz combines a multireference Slater determinant expansion,
Gaussian-type cusp-corrected molecular orbitals (<code class="xref py py-class docutils literal notranslate"><span class="pre">MolecularOrbital</span></code>),
electronic cusp Jastrow factor (<code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicAsymptotic</span></code>) and
trainable Jastrow factor and backflow transformation (<code class="xref py py-class docutils literal notranslate"><span class="pre">OmniSchNet</span></code>).</p>
<div class="math">
\[\psi_{\boldsymbol\theta}(\mathbf r) =\mathrm e^{\gamma(\mathbf
r)+J_{\boldsymbol\theta}(\mathbf x_i^{(L)})}
\sum_{pq}\frac{c_p}{N_\text{bf}}
\det[\tilde{\boldsymbol\varphi}_{\boldsymbol\theta,pq}^\uparrow(\mathbf
r)]
\det[\tilde{\boldsymbol\varphi}_{\boldsymbol\theta,pq}^\downarrow(\mathbf
r)] \\ \tilde\varphi_{\boldsymbol\theta,pq\nu i}(\mathbf r)
:=\varphi_{\mu_{p\nu}}(\mathbf r_i)\star\big(\mathbf f_{*_1}(\mathbf
x_i^{(L)})\big)_{*_2} \\ (*_1,*_2)=\begin{cases} (q,\mu_{p\nu}) &
\text{orbital-type backflow} \\ (pq,\nu) & \text{determinant-type
backflow} \end{cases}

\]</div>
<p>Here, <span class="math">\(\mathbf x_i^{(L)}\)</span> are the permutation-equivariant electron
embeddings obtained from a graph neural network, <span class="math">\(\mu_{p\nu}\)</span>
defines the electron configurations with the corresponding linear coefficients
<span class="math">\(c_p\)</span>, <span class="math">\(\varphi_\mu(\mathbf r)\)</span> are
the baseline single-electron molecular orbitals,
<span class="math">\(J_{\boldsymbol\theta}\)</span> is the permutation-invariant deep Jastrow
factor, <span class="math">\(\mathbf f_{\boldsymbol\theta}\)</span> is the
permutation-equivariant deep backflow, and <span class="math">\(\gamma\)</span>
enforces correct electronic cusp conditions.
Based on the type of the backflow, the backflow is applied either
orbital-wise or determinant-wise, and <span class="math">\(\star\)</span> can be either multiplication
or addition.
<span class="math">\(N_\text{bf}\)</span> different backflows indexed by <span class="math">\(q\)</span> are used with
each electron configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mol</strong> (<a class="reference internal" href="#deepqmc.Molecule" title="deepqmc.Molecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule</span></code></a>) – molecule whose wave function is represented</p></li>
<li><p><strong>basis</strong> (<a class="reference internal" href="#deepqmc.wf.paulinet.GTOBasis" title="deepqmc.wf.paulinet.GTOBasis"><code class="xref py py-class docutils literal notranslate"><span class="pre">GTOBasis</span></code></a>) – basis for the molecular orbitals</p></li>
<li><p><strong>n_configurations</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of electron configurations</p></li>
<li><p><strong>n_orbitals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of distinct molecular orbitals used across all
configurations if given, otherwise the larger of the number of spin-up
and spin-down electrons</p></li>
<li><p><strong>cusp_correction</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether nuclear cusp correction is used</p></li>
<li><p><strong>cusp_electrons</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether electronic cusp function is used</p></li>
<li><p><strong>backflow_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – <code class="docutils literal notranslate"><span class="pre">'orbital'</span></code> for orbital-type backflow, <code class="docutils literal notranslate"><span class="pre">'det'</span></code>
for determinant-type backflow</p></li>
<li><p><strong>backflow_channels</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{bf}\)</span>, number of backflow channels</p></li>
<li><p><strong>backflow_transform</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – <p>specifies the <span class="math">\(\star\)</span> operation:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'mult'</span></code> – <span class="math">\(x\star y:=x\big(1+2\tanh(y)\big)\)</span></p></li>
</ul>
</p></li>
<li><p><strong>omni_factory</strong> (<em>callable</em>) – constructor for combined a Jastrow and backflow,
<span class="math">\((M,N^\uparrow,N^\downarrow,N_\text{orb},N_\text{bf})\)</span>
<span class="math">\(\rightarrow(r_{ij},R_{iI})\rightarrow (J,f_{q\mu i})\)</span></p></li>
<li><p><strong>omni_kwargs</strong> – extra arguments passed to <code class="docutils literal notranslate"><span class="pre">omni_factory</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>omni</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a> representing Jastrow and backflow</p></li>
<li><p><strong>conf_coeff</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html#torch.nn.Linear" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Linear</span></code></a> with no bias that represents
the multireference coefficients <span class="math">\(c_p\)</span> via its <code class="xref py py-attr docutils literal notranslate"><span class="pre">weight</span></code>
variable of shape <span class="math">\((1,N_\text{det})\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="deepqmc.wf.PauliNet.from_hf">
<em class="property">classmethod </em><code class="sig-name descname">from_hf</code><span class="sig-paren">(</span><em class="sig-param">mol</em>, <em class="sig-param">*</em>, <em class="sig-param">basis='6-311g'</em>, <em class="sig-param">cas=None</em>, <em class="sig-param">workdir=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/paulinet.html#PauliNet.from_hf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.PauliNet.from_hf" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a <a class="reference internal" href="#deepqmc.wf.PauliNet" title="deepqmc.wf.PauliNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliNet</span></code></a> instance by running a HF calculation.</p>
<p>This is the top-level interface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mol</strong> (<a class="reference internal" href="#deepqmc.Molecule" title="deepqmc.Molecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule</span></code></a>) – molecule whose wave function
is represented</p></li>
<li><p><strong>basis</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – basis of the internal HF calculation</p></li>
<li><p><strong>cas</strong> (<em>(</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>)</em>) – tuple of the number of active orbitals and number of
active electrons for a complete active space multireference
HF calculation</p></li>
<li><p><strong>workdir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – path where PySCF calculations are cached</p></li>
<li><p><strong>kwargs</strong> – all other arguments are passed to <a class="reference internal" href="#deepqmc.wf.PauliNet.from_pyscf" title="deepqmc.wf.PauliNet.from_pyscf"><code class="xref py py-func docutils literal notranslate"><span class="pre">PauliNet.from_pyscf()</span></code></a></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="deepqmc.wf.PauliNet.from_pyscf">
<em class="property">classmethod </em><code class="sig-name descname">from_pyscf</code><span class="sig-paren">(</span><em class="sig-param">mf</em>, <em class="sig-param">*</em>, <em class="sig-param">init_weights=True</em>, <em class="sig-param">freeze_mos=True</em>, <em class="sig-param">freeze_confs=False</em>, <em class="sig-param">conf_cutoff=0.01</em>, <em class="sig-param">conf_limit=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/paulinet.html#PauliNet.from_pyscf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.PauliNet.from_pyscf" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a <a class="reference internal" href="#deepqmc.wf.PauliNet" title="deepqmc.wf.PauliNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliNet</span></code></a> instance from a finished <a class="reference external" href="http://pyscf.org">PySCF</a> calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<a class="reference external" href="http://pyscf.org/pyscf/modules/scf.html#pyscf.scf.hf.RHF" title="(in PySCF v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.hf.RHF</span></code></a> | <a class="reference external" href="http://pyscf.org/pyscf/modules/mcscf.html#pyscf.mcscf.mc1step.CASSCF" title="(in PySCF v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.mcscf.mc1step.CASSCF</span></code></a>) – restricted (multireference) HF calculation</p></li>
<li><p><strong>init_weights</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether molecular orbital coefficients and
configuration coefficients are initialized from the HF calculation</p></li>
<li><p><strong>freeze_mos</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the MO coefficients are frozen for
gradient optimization</p></li>
<li><p><strong>freeze_confs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the configuration coefficients are
frozen for gradient optimization</p></li>
<li><p><strong>conf_cutoff</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – determinants with a linear coefficient above
this threshold are included in the determinant expansion</p></li>
<li><p><strong>conf_limit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – if given, at maximum the given number of configurations
with the largest linear coefficients are used in the ansatz</p></li>
<li><p><strong>kwargs</strong> – all other arguments are passed to the <a class="reference internal" href="#deepqmc.wf.PauliNet" title="deepqmc.wf.PauliNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliNet</span></code></a>
constructor</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<span class="target" id="module-deepqmc.wf.paulinet"></span><dl class="class">
<dt id="deepqmc.wf.paulinet.OmniSchNet">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">OmniSchNet</code><span class="sig-paren">(</span><em class="sig-param">n_atoms</em>, <em class="sig-param">n_up</em>, <em class="sig-param">n_down</em>, <em class="sig-param">n_orbitals</em>, <em class="sig-param">n_backflows</em>, <em class="sig-param">*</em>, <em class="sig-param">mb_embedding_dim=128</em>, <em class="sig-param">mf_embedding_dim=128</em>, <em class="sig-param">jastrow='many-body'</em>, <em class="sig-param">jastrow_kwargs=None</em>, <em class="sig-param">backflow='many-body'</em>, <em class="sig-param">backflow_kwargs=None</em>, <em class="sig-param">schnet_kwargs=None</em>, <em class="sig-param">subnet_kwargs=None</em>, <em class="sig-param">mf_schnet_kwargs=None</em>, <em class="sig-param">mf_subnet_kwargs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/omni.html#OmniSchNet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.OmniSchNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Combined Jastrow/backflow neural network based on SchNet.</p>
<p>This module uses an instance of <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a> to build a
many-body or a mean-field feature representation of electrons, which are
subsequently passed as an input into additional trainable functions to
obtain many-body or mean-field Jastrow factor and backflow transformations.
The mean-field embeddings are obtained with a variant of
<a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a> with the electron–electron message passing omitted.
The type of embeddings used for Jastrow and backflow can be chosen
individually and equivalent embbedings are shared. The module is used to
generate the Jastrow factor and backflow transformation within
<a class="reference internal" href="#deepqmc.wf.PauliNet" title="deepqmc.wf.PauliNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliNet</span></code></a>.</p>
<p>The Jastrow factor and backflow are obtained as</p>
<div class="math">
\[J:=\eta_{\boldsymbol\theta}\big(\textstyle\sum_i\mathbf
x_i^{(L)}\big),\qquad
f_{q\mu i}(\mathbf r)
:=\Big(\boldsymbol\kappa_{\boldsymbol\theta,q}\big(\mathbf
x_i^{(L)}\big)\Big)_\mu

\]</div>
<p>where <span class="math">\(\eta_{\boldsymbol\theta}\)</span> and
<span class="math">\(\boldsymbol\kappa_{\boldsymbol\theta,q}\)</span> are vanilla deep
neural networks and <span class="math">\(\mathbf x_i^{(L)}\)</span> are either the many-body or
mean-field embedding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_atoms</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(M\)</span>, number of atoms</p></li>
<li><p><strong>n_up</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N^\uparrow\)</span>, number of spin-up electrons</p></li>
<li><p><strong>n_down</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N^\downarrow\)</span>, number of spin-down electrons</p></li>
<li><p><strong>n_orbitals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{orb}\)</span>, number of molecular orbitals</p></li>
<li><p><strong>n_backflows</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{bf}\)</span>, number of backflow channnels</p></li>
<li><p><strong>mb_embedding_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – dimension of many-body SchNet embeddings</p></li>
<li><p><strong>mf_embedding_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – dimension of mean-field SchNet embeddings</p></li>
<li><p><strong>jastrow</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – type of Jastrow – <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code></a>, <code class="docutils literal notranslate"><span class="pre">'mean-field'</span></code>, or
<code class="docutils literal notranslate"><span class="pre">'many-body'</span></code></p></li>
<li><p><strong>jastrow_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to <a class="reference internal" href="#deepqmc.wf.paulinet.Jastrow" title="deepqmc.wf.paulinet.Jastrow"><code class="xref py py-class docutils literal notranslate"><span class="pre">Jastrow</span></code></a></p></li>
<li><p><strong>backflow</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – type of backflow – <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code></a>, <code class="docutils literal notranslate"><span class="pre">'mean-field'</span></code>, or
<code class="docutils literal notranslate"><span class="pre">'many-body'</span></code></p></li>
<li><p><strong>backflow_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to <a class="reference internal" href="#deepqmc.wf.paulinet.Backflow" title="deepqmc.wf.paulinet.Backflow"><code class="xref py py-class docutils literal notranslate"><span class="pre">Backflow</span></code></a></p></li>
<li><p><strong>schnet_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a></p></li>
<li><p><strong>subnet_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to <a class="reference internal" href="#deepqmc.wf.paulinet.SubnetFactory" title="deepqmc.wf.paulinet.SubnetFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubnetFactory</span></code></a></p></li>
<li><p><strong>mf_schnet_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to the mean-field variant
of <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a></p></li>
<li><p><strong>mf_subnet_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – extra arguments passed to <a class="reference internal" href="#deepqmc.wf.paulinet.SubnetFactory" title="deepqmc.wf.paulinet.SubnetFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubnetFactory</span></code></a></p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input1, <span class="math">\(\lvert\mathbf r_i-\mathbf r_j\rvert\)</span>: <span class="math">\((*,N,N)\)</span></p></li>
<li><p>Input2, <span class="math">\(\lvert\mathbf r_i-\mathbf R_I\rvert\)</span>: <span class="math">\((*,N,M)\)</span></p></li>
<li><p>Output1, <span class="math">\(J\)</span>: <span class="math">\((*)\)</span></p></li>
<li><p>Output2, <span class="math">\(f_{q\mu i}\)</span>: <span class="math">\((*,N_\text{bf},N,N_\text{orb})\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>schnet</strong> – <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a> network</p></li>
<li><p><strong>mf_schnet</strong> – mean-field variant of <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a> network</p></li>
<li><p><strong>jastrow</strong> – <a class="reference internal" href="#deepqmc.wf.paulinet.Jastrow" title="deepqmc.wf.paulinet.Jastrow"><code class="xref py py-class docutils literal notranslate"><span class="pre">Jastrow</span></code></a> network</p></li>
<li><p><strong>backflow</strong> – <a class="reference internal" href="#deepqmc.wf.paulinet.Backflow" title="deepqmc.wf.paulinet.Backflow"><code class="xref py py-class docutils literal notranslate"><span class="pre">Backflow</span></code></a> network</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.Jastrow">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">Jastrow</code><span class="sig-paren">(</span><em class="sig-param">embedding_dim</em>, <em class="sig-param">activation_factory=&lt;class 'deepqmc.torchext.utils.SSP'&gt;</em>, <em class="sig-param">*</em>, <em class="sig-param">n_layers=3</em>, <em class="sig-param">sum_first=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/omni.html#Jastrow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.Jastrow" title="Permalink to this definition">¶</a></dt>
<dd><p>Jastrow network <span class="math">\(\eta_{\boldsymbol \theta}\)</span>.</p>
<p>The Jastrow factor consists of a vanilla neural network with logarithmically
progressing layer widths that maps the electronic embeddings to the final
Jastrow factor,</p>
<div class="math">
\[J :=
\begin{cases}
\eta_{\boldsymbol \theta}\big(\textstyle\sum_i \mathbf x_i^
{(L)}\big) & \text{if }\texttt{sum\_first}\\
\textstyle\sum_i\eta_{\boldsymbol \theta}\big(\mathbf x_i^
{(L)}\big) & \text{otherwise}
\end{cases}

\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embedding_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf x_i^{(L)})\)</span>,
dimension of electronic embedding input</p></li>
<li><p><strong>activation_factory</strong> (<em>callable</em>) – creates activation functions between
layers</p></li>
<li><p><strong>n_layers</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of neural network layers</p></li>
<li><p><strong>sum_first</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether embeddings are summed before passed to the
network</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <span class="math">\(\mathbf x_i^{(L)}\)</span>: <span class="math">\((*,N,D)\)</span></p></li>
<li><p>Output, <span class="math">\(J\)</span>: <span class="math">\((*)\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><p><strong>net</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Sequential.html#torch.nn.Sequential" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Sequential</span></code></a> representing vanilla neural network</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.Backflow">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">Backflow</code><span class="sig-paren">(</span><em class="sig-param">embedding_dim</em>, <em class="sig-param">n_orbitals</em>, <em class="sig-param">n_backflows</em>, <em class="sig-param">activation_factory=&lt;class 'deepqmc.torchext.utils.SSP'&gt;</em>, <em class="sig-param">*</em>, <em class="sig-param">n_layers=3</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/omni.html#Backflow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.Backflow" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents backflow networks <span class="math">\(\boldsymbol\kappa_{\boldsymbol\theta,q}\)</span>.</p>
<p>The backflow transformation consists of <span class="math">\(N_\text{bf}\)</span> vanilla neural
networks with logarithmically progressing layer width maping the electronic
embeddings to the backflow transformations,</p>
<div class="math">
\[\mathbf f_i := \mathbf \kappa_{\boldsymbol \theta}\big(\mathbf x_i^{(L,
\text{mf/bf})}\big)

\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embedding_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf x_i^{(L)})\)</span>,
dimension of electronic embedding input</p></li>
<li><p><strong>n_orbitals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{orb}\)</span> number of orbitals</p></li>
<li><p><strong>n_backflows</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{bf}\)</span> number of backflows</p></li>
<li><p><strong>activation_factory</strong> (<em>callable</em>) – creates activation functions between
layers</p></li>
<li><p><strong>n_layers</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of neural network layers</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <span class="math">\(\mathbf x_i^{(L)}\)</span>: <span class="math">\((*,N,D)\)</span></p></li>
<li><p>Output, <span class="math">\(f_{q\mu i}\)</span>: <span class="math">\((*,N_\text{bf},N,N_\text{orb})\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><p><strong>nets</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.ModuleList.html#torch.nn.ModuleList" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code></a> containing <span class="math">\(N_text{bf}\)</span>
vanilla neural networks</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.ElectronicSchNet">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">ElectronicSchNet</code><span class="sig-paren">(</span><em class="sig-param">n_up</em>, <em class="sig-param">n_down</em>, <em class="sig-param">n_nuclei</em>, <em class="sig-param">embedding_dim</em>, <em class="sig-param">subnet_metafactory=None</em>, <em class="sig-param">*</em>, <em class="sig-param">dist_feat_dim=32</em>, <em class="sig-param">dist_feat_cutoff=10.0</em>, <em class="sig-param">n_interactions=3</em>, <em class="sig-param">kernel_dim=64</em>, <em class="sig-param">version=2</em>, <em class="sig-param">layer_norm=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/schnet.html#ElectronicSchNet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Graph neural network SchNet adapted to handle electrons.</p>
<p>SchNet constructs many-body feature representations of electrons that are
invariant with respect to the translation and rotation of the whole molecule
and equivariant with respect to exchange of same-spin electrons, by
iteratively refining initial one-electron embeddings through mutual message
passing modulated by electron distances,</p>
<div class="math">
\[\begin{aligned}
\mathbf x_i^{(0)}&:=\mathbf X \\
\mathbf x_i^{(n+1)}&:=\mathbf x_i^{(n)}
  +\boldsymbol\chi^{(n)}_{\boldsymbol\theta}\big(
  \big\{\mathbf x_j^{(n)},\{\mathbf e(|\mathbf r_j-\mathbf r_k|)\}\big\}
  \big)
\end{aligned}

\]</div>
<p>This module implements two versions of the iterative update rule, with only
version 2 being documented,</p>
<div class="math">
\[\begin{aligned}
\mathbf z_i^{(n,\pm)}&:=\sum\nolimits_{j\neq i}^\pm
  \mathbf w^{(n,\pm)}_{\boldsymbol\theta}
  \big(\mathbf e(\lvert\mathbf r_i-\mathbf r_j\rvert)\big)
  \odot\mathbf h_{\boldsymbol\theta}^{(n)}\big(\mathbf x_j^{(n)}\big) \\
\mathbf z_i^{(n,\mathrm n)}&:=\sum\nolimits_I
  \mathbf w_{\boldsymbol\theta}^{(n,\mathrm n)}
  \big(\mathbf e(\lvert\mathbf r_i-\mathbf R_I\rvert)\big)
  \odot\mathbf Y_{\boldsymbol\theta,I} \\
\mathbf x_i^{(n+1)}&:=\mathbf x_i^{(n)}
  +\sum\nolimits_\pm\mathbf g^{(n,\pm)}_{\boldsymbol\theta}
  \big(\mathbf z_i^{(n,\pm)}\big)
  +\mathbf g^{(n,\mathrm n)}_{\boldsymbol\theta}
  \big(\mathbf z_i^{(n,\mathrm n)}\big)
\end{aligned}

\]</div>
<p>Here, “<span class="math">\(\odot\)</span>” denotes element-wise multiplication,
<span class="math">\(\mathbf w_{\boldsymbol\theta}^{(n)}\)</span>,
<span class="math">\(\mathbf h^{(n)}_{\boldsymbol\theta}\)</span>, and
<span class="math">\(\mathbf g_{\boldsymbol\theta}^{(n)}\)</span> are trainable functions
represented by vanilla fully-connected (deep) neural networks,
<span class="math">\(\mathbf Y_{\boldsymbol\theta},I}\)</span> are nuclear embeddings, and
<span class="math">\(\mathbf e\)</span> are distance features.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_up</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N^\uparrow\)</span>, number of spin-up electrons</p></li>
<li><p><strong>n_down</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N^\downarrow\)</span>, number of spin-down electrons</p></li>
<li><p><strong>n_nuclei</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <em>M</em>, number of nuclei in a molecule</p></li>
<li><p><strong>embedding_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf X)\)</span>, dimension of electron embeddings</p></li>
<li><p><strong>subnet_metafactory</strong> (<em>callable</em>) – factory,
<span class="math">\((\dim(\mathbf e),\dim(\mathbf w),\dim(\mathbf X))\)</span>
<span class="math">\(\rightarrow(\mathbf w,\mathbf h,\mathbf g)\)</span>, with the
interface of <a class="reference internal" href="#deepqmc.wf.paulinet.SubnetFactory" title="deepqmc.wf.paulinet.SubnetFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubnetFactory</span></code></a></p></li>
<li><p><strong>dist_feat_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf e)\)</span>, number of distance features</p></li>
<li><p><strong>dist_feat_cutoff</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>a.u.</em>) – distance at which distance features
go to zero</p></li>
<li><p><strong>n_interactions</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <em>L</em>, number of message passing iterations</p></li>
<li><p><strong>kernel_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf w)\)</span>, dimension of the convolution kernel</p></li>
<li><p><strong>version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – architecture version, one of <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input1, <span class="math">\(\mathbf e(\lvert\mathbf r_i-\mathbf r_j\rvert)\)</span>:
<span class="math">\((*,N,N,\dim(\mathbf e))\)</span></p></li>
<li><p>Input2, <span class="math">\(\mathbf e(\lvert\mathbf r_i-\mathbf R_I\rvert)\)</span>:
<span class="math">\((*,N,M,\dim(\mathbf e))\)</span></p></li>
<li><p>Output: <span class="math">\(\mathbf x_i^{(L)}\)</span>: <span class="math">\((*,N,\dim(\mathbf X))\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> – electronic embeddings of shape <span class="math">\((1,\dim(\mathbf X))\)</span> if
<span class="math">\(N^\uparrow=N^\downarrow\)</span> and <span class="math">\((2,\dim(\mathbf X))\)</span>
otherwise</p></li>
<li><p><strong>Y</strong> – nuclear embeddings of shape <span class="math">\((M,\dim(\mathbf w))\)</span></p></li>
<li><p><strong>w</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.ModuleDict.html#torch.nn.ModuleDict" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code></a> that contain all trainable
<span class="math">\(\mathbf w^{(\cdot)}\)</span> subnetworks</p></li>
<li><p><strong>g</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.ModuleDict.html#torch.nn.ModuleDict" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code></a> that contain all trainable
<span class="math">\(\mathbf g^{(\cdot)}\)</span> subnetworks</p></li>
<li><p><strong>h</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.ModuleDict.html#torch.nn.ModuleDict" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code></a> that contain all trainable
<span class="math">\(\mathbf h^{(\cdot)}\)</span> subnetworks</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.SubnetFactory">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">SubnetFactory</code><span class="sig-paren">(</span><em class="sig-param">dist_feat_dim</em>, <em class="sig-param">kernel_dim</em>, <em class="sig-param">embedding_dim</em>, <em class="sig-param">*</em>, <em class="sig-param">n_layers_w=2</em>, <em class="sig-param">n_layers_h=1</em>, <em class="sig-param">n_layers_g=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/schnet.html#SubnetFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.SubnetFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates subnetworks for <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a>.</p>
<p>The <a class="reference internal" href="#deepqmc.wf.paulinet.ElectronicSchNet" title="deepqmc.wf.paulinet.ElectronicSchNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElectronicSchNet</span></code></a> constructor expects this class constructor. To
change the default subnetwork depths, use <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.partial()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dist_feat_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf e)\)</span>, number of distance features</p></li>
<li><p><strong>kernel_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf w)\)</span>, dimension of the convolution kernel</p></li>
<li><p><strong>embedding_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf X)\)</span>, dimension of electron embeddings</p></li>
<li><p><strong>n_layers_w</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of layers in the <span class="math">\(\mathbf w\)</span> networks</p></li>
<li><p><strong>n_layers_h</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of layers in the <span class="math">\(\mathbf h\)</span> networks</p></li>
<li><p><strong>n_layers_g</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – number of layers in the <span class="math">\(\mathbf g\)</span> networks</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="deepqmc.wf.paulinet.SubnetFactory.g_subnet">
<code class="sig-name descname">g_subnet</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/schnet.html#SubnetFactory.g_subnet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.SubnetFactory.g_subnet" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the <span class="math">\(\mathbf g\)</span> network.</p>
</dd></dl>

<dl class="method">
<dt id="deepqmc.wf.paulinet.SubnetFactory.h_subnet">
<code class="sig-name descname">h_subnet</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/schnet.html#SubnetFactory.h_subnet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.SubnetFactory.h_subnet" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the <span class="math">\(\mathbf h\)</span> network.</p>
</dd></dl>

<dl class="method">
<dt id="deepqmc.wf.paulinet.SubnetFactory.w_subnet">
<code class="sig-name descname">w_subnet</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/schnet.html#SubnetFactory.w_subnet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.SubnetFactory.w_subnet" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the <span class="math">\(\mathbf w\)</span> network.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.DistanceBasis">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">DistanceBasis</code><span class="sig-paren">(</span><em class="sig-param">dist_feat_dim</em>, <em class="sig-param">cutoff=10.0</em>, <em class="sig-param">envelope='physnet'</em>, <em class="sig-param">smooth=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/distbasis.html#DistanceBasis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.DistanceBasis" title="Permalink to this definition">¶</a></dt>
<dd><p>Expands distances in distance feature basis.</p>
<p>Maps distances, <em>d</em>, to distance features, <span class="math">\(\mathbf e(d)\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dist_feat_dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(\dim(\mathbf e)\)</span>, number of features</p></li>
<li><p><strong>cutoff</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>a.u.</em>) – distance at which all features go to zero</p></li>
<li><p><strong>envelope</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – <p>type of envelope for distance features</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'physnet'</span></code>: taken from <a class="reference internal" href="refs.html#unkejctc19" id="id3"><span>[UnkeJCTC19]</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'nocusp'</span></code>: used in <a class="reference internal" href="refs.html#hermannnc20" id="id4"><span>[HermannNC20]</span></a></p></li>
</ul>
</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <em>d</em>: <span class="math">\((*)\)</span></p></li>
<li><p>Output, <span class="math">\(\mathbf e(d)\)</span>: <span class="math">\((*,\dim(\mathbf e))\)</span></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.CuspCorrection">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">CuspCorrection</code><span class="sig-paren">(</span><em class="sig-param">charges</em>, <em class="sig-param">n_orbitals</em>, <em class="sig-param">rc</em>, <em class="sig-param">eps=1e-06</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/cusp.html#CuspCorrection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.CuspCorrection" title="Permalink to this definition">¶</a></dt>
<dd><p>Corrects nuclear cusp of Gaussian-type molecular orbitals.</p>
<p>The implementation closely follows <a class="reference internal" href="refs.html#majcp05" id="id5"><span>[MaJCP05]</span></a>. Each orbital
<span class="math">\(\varphi_\mu(\mathbf r)\)</span> is decomposed to its <em>s</em>-type part centered
on the <em>I</em>-th nucleus, and the rest,</p>
<div class="math">
\[\varphi_\mu(\mathbf r)=s_{\mu I}(|\mathbf r-\mathbf R_I|)
+\phi_{\mu I}(\mathbf r)

\]</div>
<p>Within a cutoff radius, <span class="math">\(r_\text c\)</span>, the <em>s</em>-type part is replaced
by a 4-th order polynomial that fits on four boundary values,</p>
<div class="math">
\[\mathbf b_{\mu I}=\big(
    s_{\mu I}(0),
    s_{\mu I}(r_\text c),
    s_{\mu I}'(r_\text c),
    s_{\mu I}''(r_\text c)
\big)

\]</div>
<p>The fifth coefficient of the polynomial is
fixed by the cusp condition,</p>
<div class="math">
\[\frac1{\varphi_\mu(\mathbf r)}\frac{\partial\varphi_\mu(\mathbf r)}
{\partial|\mathbf r-\mathbf R_I|}
\bigg|_{\mathbf r=\mathbf R_I}=-Z_I

\]</div>
<p>The value of the corrected <em>s</em>-type part at the center,
<span class="math">\(s_{\mu I}(0)\)</span>, is further adjusted by a trainable relative shift,
<span class="math">\(\Delta_{\mu I}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>charges</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></a><span class="math">\((M)\)</span>) – <span class="math">\(Z_I\)</span>, nuclear charges</p></li>
<li><p><strong>n_orbitals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{orb}\)</span>, number of orbitals</p></li>
<li><p><strong>rc</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></a><span class="math">\((M)\)</span>) – <span class="math">\(r_\text c\)</span>, cutoff radii</p></li>
<li><p><strong>eps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – <span class="math">\(\varepsilon\)</span>, numerical zero. An orbital
is considered to have a non-zero <em>s</em>-type part if
<span class="math">\(s_{\mu I}(0)&gt;\varepsilon\)</span>.</p></li>
</ul>
</dd>
</dl>
<p>On output, the module returns the mask of corrected electron positions,
the indexes of the nuclei that triggered the correction, and the corrected
<em>s</em>-type part.</p>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input1, <span class="math">\(|\mathbf r-\mathbf R_I|^2\)</span>: <span class="math">\((*,M)\)</span></p></li>
<li><p>Input2, <span class="math">\(\mathbf b_{\mu I}\)</span>: <span class="math">\((4,M,N_\text{orb})\)</span></p></li>
<li><p>Input3, <span class="math">\(\varphi_\mu(\mathbf R_I)\)</span>: <span class="math">\((M,N_\text{orb})\)</span></p></li>
<li><p>Output1, corrected?: <span class="math">\((*,N_\text{orb})\)</span></p></li>
<li><p>Output2, which nucleus: <span class="math">\((*)\)</span></p></li>
<li><p>Output3, corrected <span class="math">\(s_{\mu I}(r)\)</span>: <span class="math">\((N_\text{corr})\)</span>,
where <span class="math">\(N_\text{corr}\)</span> is the number of nonzero elements in
the first output (only corrected orbitals are returned in a flattened
form)</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><p><strong>shifts</strong> – orbital shifts <span class="math">\(\Delta_{\mu I}\)</span> of shape
<span class="math">\((M,N_\text{orb})\)</span>, initialized to zero</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.ElectronicAsymptotic">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">ElectronicAsymptotic</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">cusp</em>, <em class="sig-param">alpha=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/cusp.html#ElectronicAsymptotic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.ElectronicAsymptotic" title="Permalink to this definition">¶</a></dt>
<dd><p>Jastrow factor with a correct electronic cusp.</p>
<p>The Jastrow factor is calculated from distances between all pairs of
electrons, <span class="math">\(d_{ij}\)</span>,</p>
<div class="math">
\[\mathrm \gamma
:=\sum_{ij}-\frac{c}{\alpha(1+\alpha d_{ij})}

\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cusp</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – <em>c</em>, target cusp value</p></li>
<li><p><strong>alpha</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – <span class="math">\(\alpha\)</span>, rate of decay of the cusp function to 1.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <span class="math">\(d_{ij}\)</span>: <span class="math">\((*,N_\text{pair})\)</span></p></li>
<li><p>Output, <span class="math">\(\gamma\)</span>: <span class="math">\((*)\)</span></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.MolecularOrbital">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">MolecularOrbital</code><span class="sig-paren">(</span><em class="sig-param">mol</em>, <em class="sig-param">basis</em>, <em class="sig-param">n_orbitals</em>, <em class="sig-param">cusp_correction=True</em>, <em class="sig-param">rc_scaling=1.0</em>, <em class="sig-param">eps=1e-06</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/molorb.html#MolecularOrbital"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.MolecularOrbital" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluates molecular orbitals from electron coordinates.</p>
<p>This module combines three submodules that sequentially transform
electron coordinates into molecular orbitals (MOs).</p>
<ol class="arabic">
<li><p><a class="reference internal" href="#deepqmc.wf.paulinet.GTOBasis" title="deepqmc.wf.paulinet.GTOBasis"><code class="xref py py-class docutils literal notranslate"><span class="pre">GTOBasis</span></code></a> transforms
<span class="math">\((\mathbf r-\mathbf R_I)\)</span> to basis functions
<span class="math">\(\xi_p(\mathbf r)\)</span></p></li>
<li><p><a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html#torch.nn.Linear" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Linear</span></code></a> transforms <span class="math">\(\xi_p(\mathbf r)\)</span> to
molecular orbitals, <span class="math">\(\varphi_\mu(\mathbf r)\)</span>,</p>
<div class="math">
\[\varphi_\mu(\mathbf r):=\sum_p C_{p\mu}\xi_p(\mathbf r)

\]</div>
</li>
<li><p>(optional) <a class="reference internal" href="#deepqmc.wf.paulinet.CuspCorrection" title="deepqmc.wf.paulinet.CuspCorrection"><code class="xref py py-class docutils literal notranslate"><span class="pre">CuspCorrection</span></code></a> corrects
<span class="math">\(\varphi_\mu(\mathbf r)\)</span> to satisfy nuclear cusp conditions</p></li>
</ol>
<p>If (3) applies, this module also determines the cusp correction cutoff radii
as <span class="math">\(r_\text c:=q/Z\)</span>, where <em>q</em> is a global factor and <em>Z</em> is a nuclear
charge, and if any two cutoff spheres overlap, reduces the radii accordingly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mol</strong> (<a class="reference internal" href="#deepqmc.Molecule" title="deepqmc.Molecule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Molecule</span></code></a>) – target molecule</p></li>
<li><p><strong>basis</strong> (<a class="reference internal" href="#deepqmc.wf.paulinet.GTOBasis" title="deepqmc.wf.paulinet.GTOBasis"><code class="xref py py-class docutils literal notranslate"><span class="pre">GTOBasis</span></code></a>) – basis functions</p></li>
<li><p><strong>n_orbitals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <span class="math">\(N_\text{orb}\)</span>, number of molecular orbitals</p></li>
<li><p><strong>cusp_correction</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the cusp correction should be applied</p></li>
<li><p><strong>rc_scaling</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – <em>q</em>, global scaling for cusp correction cutoff radii</p></li>
<li><p><strong>eps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – numerical zero, passed to <a class="reference internal" href="#deepqmc.wf.paulinet.CuspCorrection" title="deepqmc.wf.paulinet.CuspCorrection"><code class="xref py py-class docutils literal notranslate"><span class="pre">CuspCorrection</span></code></a></p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input1, <span class="math">\((\mathbf r-\mathbf R_I)\)</span>: <span class="math">\((*,M,4)\)</span>, see <a class="reference internal" href="refs.html#dim4" id="id6"><span>[dim4]</span></a></p></li>
<li><p>Output, <span class="math">\(\varphi_\mu(\mathbf r)\)</span>: <span class="math">\((*,N_\text{orb})\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><p><strong>mo_coeff</strong> – <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html#torch.nn.Linear" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Linear</span></code></a> with no bias that represents MO coefficients
<span class="math">\(C_{p\mu}\)</span> via its <code class="xref py py-attr docutils literal notranslate"><span class="pre">weight</span></code> variable of shape
<span class="math">\((N_\text{orb},N_\text{basis})\)</span></p>
</dd>
</dl>
<dl class="method">
<dt id="deepqmc.wf.paulinet.MolecularOrbital.init_from_pyscf">
<code class="sig-name descname">init_from_pyscf</code><span class="sig-paren">(</span><em class="sig-param">mf</em>, <em class="sig-param">freeze_mos=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/molorb.html#MolecularOrbital.init_from_pyscf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.MolecularOrbital.init_from_pyscf" title="Permalink to this definition">¶</a></dt>
<dd><p>Reinitialize the MO coefficient from a PySCF calculation object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<a class="reference external" href="http://pyscf.org/pyscf/modules/scf.html#pyscf.scf.hf.RHF" title="(in PySCF v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.hf.RHF</span></code></a> | <a class="reference external" href="http://pyscf.org/pyscf/modules/mcscf.html#pyscf.mcscf.mc1step.CASSCF" title="(in PySCF v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.mcscf.mc1step.CASSCF</span></code></a>) – restricted (multireference) HF calculation</p></li>
<li><p><strong>freeze_mos</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the MO coefficients should be frozen</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.GTOBasis">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">GTOBasis</code><span class="sig-paren">(</span><em class="sig-param">centers</em>, <em class="sig-param">shells</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/gto.html#GTOBasis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.GTOBasis" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps electron coordinates to Gaussian-type basis functions.</p>
<p>The basis consists of Gaussian-type shells of various angular degree, <em>l</em>,
centered at <span class="math">\(\mathbf R_I\)</span>, each containing <span class="math">\((2l+1)\)</span> basis functions.</p>
<p>An instance can be queried with <a class="reference external" href="https://docs.python.org/3/library/functions.html#len" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">len()</span></code></a> to obtain the total number of
basis functions, <span class="math">\(N_\text{basis}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centers</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></a><span class="math">\((M,3)\)</span>) – <span class="math">\(\mathbf R_I\)</span>, basis
center coordinates</p></li>
<li><p><strong>shells</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – each item is a 2-tuple (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference internal" href="#deepqmc.wf.paulinet.GTOShell" title="deepqmc.wf.paulinet.GTOShell"><code class="xref py py-class docutils literal notranslate"><span class="pre">GTOShell</span></code></a>)
encoding a shell placed at a center given by its index</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <span class="math">\((\mathbf r-\mathbf R_I)\)</span>: <span class="math">\((*,M,4)\)</span>, see <a class="reference internal" href="refs.html#dim4" id="id7"><span>[dim4]</span></a></p></li>
<li><p>Output, <span class="math">\(\xi_p(\mathbf r)\)</span>: <span class="math">\((*,N_\text{basis})\)</span></p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="deepqmc.wf.paulinet.GTOBasis.from_pyscf">
<em class="property">classmethod </em><code class="sig-name descname">from_pyscf</code><span class="sig-paren">(</span><em class="sig-param">mol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/gto.html#GTOBasis.from_pyscf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.GTOBasis.from_pyscf" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct the basis from a PySCF molecule object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mol</strong> (<a class="reference external" href="http://pyscf.org/pyscf/modules/gto.html#id0" title="(in PySCF v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.gto.mole.Mole</span></code></a>) – a molecule</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="deepqmc.wf.paulinet.GTOShell">
<em class="property">class </em><code class="sig-prename descclassname">deepqmc.wf.paulinet.</code><code class="sig-name descname">GTOShell</code><span class="sig-paren">(</span><em class="sig-param">l</em>, <em class="sig-param">coeffs</em>, <em class="sig-param">zetas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deepqmc/wf/paulinet/gto.html#GTOShell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deepqmc.wf.paulinet.GTOShell" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps electron coordinates to a single Gaussian-type basis shell.</p>
<p>The basis functions are of the Cartesian type, each specified by its
angular momentum, <span class="math">\(\mathbf l=(l_x,l_y,l_z), l=l_x+l_y+l_z\)</span>. The radial
part is encoded as a linear combination of Gaussians,</p>
<div class="math">
\[\xi_{\mathbf l}(\mathbf r)
:=x^{l_x}y^{l_y}z^{l_z}\sum_m\mathrm c_me^{-\zeta_mr^2}

\]</div>
<p>The instance can be queried with <a class="reference external" href="https://docs.python.org/3/library/functions.html#len" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">len()</span></code></a> to get the total number of
different angular momenta, <span class="math">\(N_\mathbf l\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <em>l</em>, total angular momentum</p></li>
<li><p><strong>coeffs</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></a><span class="math">\(N_\text g\)</span>) – <span class="math">\(c_m\)</span>, Gaussian
linear coefficients</p></li>
<li><p><strong>zetas</strong> (<a class="reference external" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch vmaster (1.7.0a0+57bffc3 ))"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></a><span class="math">\(N_\text g\)</span>) – <span class="math">\(\zeta_m\)</span>, Gaussian
exponential coefficients</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Shape:</dt><dd><ul class="simple">
<li><p>Input, <span class="math">\(\mathbf r\)</span>: <span class="math">\((*,4)\)</span>, see <a class="reference internal" href="refs.html#dim4" id="id8"><span>[dim4]</span></a></p></li>
<li><p>Output, <span class="math">\(\xi_{\mathbf l}(\mathbf r)\)</span>: <span class="math">\((*,N_\mathbf l)\)</span></p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019-2021, Frank Noé and collaborators.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>